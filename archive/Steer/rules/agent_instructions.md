# AI-Summary Codex — Refactoring & Consistency Rules (Park David Style)

## 0. 기본 태도
- 코드는 ‘추가(add)’보다 ‘정리(cleanup) + 일관성(consistency)’이 우선이다.
- 한 부분을 고치면, 그 변경이 미치는 **전체 영향 범위(1→N)** 를 반드시 끝까지 따라가야 한다.
- 리팩토링은 고립된 변경이 아니라 ‘전체 구조 재정렬’임을 항상 인지한다.
- “임시로 덧댄 코드” 금지. “앞으로 유지보수 가능한 코드”를 기본 원칙으로 한다.

---

## 1. 코드 추가/수정/삭제 규칙
### ✔️ 추가 가능하되, 조건 충족
- 기존 구조와 자연스럽게 들어맞는가?
- 중복 기능을 새로 만드는 게 아닌가?
- 이미 같은 기능이 있는 코드와 충돌하지 않는가?

### ✔️ 수정 시 전체 영향도 추적
- 시그니처 변경 → 모든 호출부 수정
- 모듈/경로 변경 → import 체인 전체 수정
- 반환 형태 변경 → 관련 로직 전부 업데이트
- 파일 이름 변경 → 전체 grep 후 일관성 반영

**절대 금지:** 기존 함수는 놔두고 새 함수만 추가, 옛 코드와 새 코드가 동시에 남는 것.

### ✔️ 필요 없는 코드는 삭제
- deprecated 파일, 테스트 임시파일, 중복 app.py, 의미 없는 faiss.py 등
- import/사용처가 없고 새 코드로 대체된 잔재는 반드시 제거

---

## 2. 리팩토링 규칙
- **구조 정리:** 함수/파일 배치를 기존 구조와 통합, 책임 분리, 네임스페이스 충돌 제거.
- **일관성 유지:** 타입/패턴/네이밍/스타일을 기존과 동일하게.
- **전역 영향 반영:** UI, 파이프라인(scan→extract→embed→index), 캐시 경로, CLI/백엔드 호출까지 모두 확인.
- **레거시 정리:** 새 코드 추가 후 옛 코드 중복/스텁/미사용 import 제거.

---

## 3. 금지 리스트
1) 기존 기능과 충돌하는 새 함수/파일 추가  
2) 한 파일만 고치고 옛 코드 방치  
3) 임시 패치만 덧대기  
4) 동일 기능을 두 위치에 분산  
5) 불필요한 추상화 추가  
6) 파이프라인 영향도 무시한 붙여넣기  
7) 옛 코드와 새 코드 동시 유지  
8) 임베딩/인덱싱 로직 중복  
9) FAISS 관련 코드 생성(프로젝트에서 안 씀)

---

## 4. 코드 제안 방식
- 변경 파일 전체 목록을 먼저 제시하고, 각 파일에서 무엇을 어떻게 바꿀지 패치 형태로 안내.
- 추가만 하지 말고, 변경 + 삭제 + 정리까지 포함.

---

## 5. 정리 체크리스트
- unused code 삭제
- 중복 기능 제거
- dead import 제거
- 동일 기능 하나로 통합
- 파일/함수 이름 충돌 없음
- 코드베이스 일관성 유지
- UI/CLI/Agent/Backend 동작 확인

---

## 6. 스타일 (직설/단호/본질 우선)
- 구조가 깨지는 변경은 즉시 차단하고 수정/삭제를 요구.
- 중복 코드·쓰레기 파일·legacy 발견 시 즉시 지적.

---

### 핵심 요약
✔ 코드 추가 OK  
✔ 하지만 전체 구조까지 책임 있게 수정·정리  
✔ 필요 없는 코드는 즉시 삭제  
✔ 중복/임시 패치 금지  
✔ 전체 영향도 기반 리팩토링 필수
